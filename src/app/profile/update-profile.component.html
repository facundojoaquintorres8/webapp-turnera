<div class="container-fluid">
    <form name="myForm" role="form" novalidate (ngSubmit)="save()" [formGroup]="myForm">
        <h2 *ngIf="!myForm.get('id')!.value">Crear Perfil</h2>
        <h2 *ngIf="myForm.get('id')!.value">Editar Perfil</h2>

        <div class="row">
            <div class="col-lg-4">
                <div class="form-group">
                    <label class="form-control-label required" for="description">Descripci贸n</label>
                    <input type="text" class="form-control" name="description" id="description"
                        formControlName="description" />
                    <div
                        *ngIf="myForm.get('description')!.invalid && (myForm.get('description')!.dirty || myForm.get('description')!.touched)">
                        <small class="form-text text-danger" *ngIf="myForm.get('description')?.errors?.required">
                            El campo es requerido.
                        </small>
                    </div>
                </div>
            </div>
            <div class="col-lg-1" *ngIf="myForm.get('id')!.value">
                <div class="form-group">
                    <label class="form-control-label" for="active">Activo</label>
                    <input type="checkbox" class="form-check-input" name="active" id="active"
                        formControlName="active" />
                </div>
            </div>
        </div>

        <h3>Permisos</h3>
        <div class="container-fluid">
            <div class="row h5 text-center d-none d-sm-flex mb-0">
                <div class="col-lg-3 border">
                    Entidad
                </div>
                <div class="col-lg-3 border">
                    Acci贸n
                </div>
                <div class="col-lg-3 border">
                    Entidad
                </div>
                <div class="col-lg-3 border">
                    Acci贸n
                </div>
            </div>
            <div class="row">
                <ng-container *ngFor="let permissionByEntity of permissionsByEntities">
                    <div class="col-lg-3 d-flex border">
                        <input type="checkbox" class="form-check-input" name="selectAll" id="selectAll"
                            (change)="selectAllEntity(permissionByEntity)" [checked]="permissionByEntity.selected" />
                        <span class="lead pointer" [ngSwitch]="permissionByEntity.name"
                            (click)="selectAllEntity(permissionByEntity)">
                            <span *ngSwitchCase="'users'"
                                class="badge rounded-pill bg-light text-dark border border-dark">Usuarios</span>
                            <span *ngSwitchCase="'profiles'"
                                class="badge rounded-pill bg-light text-dark border border-dark">Perfiles</span>
                            <span *ngSwitchCase="'organizations'"
                                class="badge rounded-pill bg-light text-dark border border-dark">Mi Organizaci贸n</span>
                            <span *ngSwitchCase="'customers'"
                                class="badge rounded-pill bg-light text-dark border border-dark">Clientes</span>
                            <span *ngSwitchCase="'resourcesTypes'"
                                class="badge rounded-pill bg-light text-dark border border-dark">Tipos de
                                Recursos</span>
                            <span *ngSwitchCase="'resources'"
                                class="badge rounded-pill bg-light text-dark border border-dark">Recursos</span>
                            <span *ngSwitchCase="'agendas'"
                                class="badge rounded-pill bg-light text-dark border border-dark">Disponibilidades</span>
                            <span *ngSwitchCase="'appointments'"
                                class="badge rounded-pill bg-light text-dark border border-dark">Turnos</span>
                            <span *ngSwitchCase="'holidays'"
                                class="badge rounded-pill bg-light text-dark border border-dark">Feriados</span>
                        </span>
                    </div>
                    <div class="col-lg-3 border">
                        <div class="row" *ngFor="let action of permissionByEntity.actions; let index = index">
                            <div class="col-lg-12 d-flex">
                                <input type="checkbox" class="form-check-input"
                                    name="select + {{index}}" id="select + {{index}}"
                                    (change)="select(action.permission, permissionByEntity)"
                                    [checked]="action.permission.selected" />
                                <span class="lead pointer" [ngSwitch]="action.action"
                                    (click)="select(action.permission, permissionByEntity)">
                                    <span *ngSwitchCase="'read'" class="badge rounded-pill bg-info">Ver</span>
                                    <span *ngSwitchCase="'write'"
                                        class="badge rounded-pill bg-primary">Actualizar</span>
                                    <span *ngSwitchCase="'delete'" class="badge rounded-pill bg-danger">Eliminar</span>
                                    <span *ngSwitchCase="'book'" class="badge rounded-pill bg-warning">Reservar</span>
                                    <span *ngSwitchCase="'absent'" class="badge rounded-pill bg-dark">Ausentar</span>
                                    <span *ngSwitchCase="'cancel'" class="badge rounded-pill bg-danger">Cancelar</span>
                                    <span *ngSwitchCase="'attend'" class="badge rounded-pill bg-info">Atender</span>
                                    <span *ngSwitchCase="'finalize'"
                                        class="badge rounded-pill bg-success">Finalizar</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </ng-container>
            </div>
        </div>
        <div class="button-form mt-4">
            <button type="button" class="btn btn-secondary" (click)="previousState()" title="Cancelar">
                <i class="bi bi-ban"></i>&nbsp;Cancelar
            </button>
            <button type="submit" [disabled]="myForm.invalid || isSaving" class="btn btn-primary" title="Guardar">
                <i class="bi bi-floppy"></i>&nbsp;Guardar
            </button>
        </div>
    </form>
</div>